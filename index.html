```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Control Panel</title>
    <style>
        /* CSS sebelumnya tetap sama, hanya menambahkan beberapa penyesuaian untuk mobile dan settings modal */
        
        /* Tambahan untuk Settings Modal */
        .modal-content {
            width: 100%;
            max-width: 500px;
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin: var(--spacing-md);
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-section {
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
        }

        .form-input, .select {
            height: 44px; /* Sesuai standar UX untuk touch target */
            font-size: 14px;
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .switch {
            width: 50px;
            height: 30px;
            min-width: 44px; /* Minimum touch target */
        }

        .switch-thumb {
            width: 24px;
            height: 24px;
        }

        .switch.active .switch-thumb {
            transform: translateX(22px);
        }

        .modal-actions {
            flex-direction: row;
            gap: var(--spacing-sm);
        }

        /* Penyesuaian untuk Mobile */
        @media (max-width: 480px) {
            .modal-content {
                max-width: 95%;
                padding: var(--spacing-md);
                margin: var(--spacing-sm);
            }

            .settings-section {
                padding: var(--spacing-sm);
            }

            .form-input, .select {
                font-size: 13px;
                height: 40px;
            }

            .modal-actions {
                flex-direction: column;
            }

            .btn {
                padding: var(--spacing-sm) var(--spacing-md);
                font-size: 13px;
                height: 44px; /* Minimum touch target */
            }

            .joystick {
                width: 90px;
                height: 90px;
            }

            .joystick-knob {
                width: 32px;
                height: 32px;
            }

            .movement-btn-face {
                padding: var(--spacing-sm);
                font-size: 11px;
                height: 44px; /* Minimum touch target */
            }

            .pump-btn-face {
                padding: var(--spacing-sm);
                height: 44px;
            }
        }

        @media (orientation: landscape) and (max-width: 1024px) {
            .control-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: var(--spacing-md);
            }

            .modal-content {
                max-width: 85%;
                max-height: 80vh;
            }

            .joystick {
                width: 110px;
                height: 110px;
            }

            .joystick-knob {
                width: 38px;
                height: 38px;
            }

            .movement-btn-face, .pump-btn-face {
                padding: var(--spacing-md);
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Bagian sebelumnya dari body tetap sama hingga Settings Modal -->
    <!-- Hanya menampilkan bagian Settings Modal yang diperbarui untuk melanjutkan -->
    
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Settings</div>
                <button class="close-btn focusable" onclick="toggleSettings()" aria-label="Close Settings">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="settings-section">
                <div class="section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                        <line x1="12" y1="20" x2="12.01" y2="20"></line>
                    </svg>
                    Network Configuration
                </div>
                <div class="form-group">
                    <label class="form-label" for="wifi-ssid">WiFi SSID</label>
                    <input type="text" class="form-input focusable" id="wifi-ssid" value="ESP32_Network" aria-label="WiFi SSID">
                </div>
                <div class="form-group">
                    <label class="form-label" for="wifi-password">WiFi Password</label>
                    <input type="password" class="form-input focusable" id="wifi-password" value="********" aria-label="WiFi Password">
                </div>
                <div class="form-group">
                    <label class="form-label" for="ip-address">IP Address</label>
                    <input type="text" class="form-input focusable" id="ip-address" value="192.168.1.105" aria-label="IP Address">
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                    </svg>
                    Device Configuration
                </div>
                <div class="form-group">
                    <label class="form-label" for="device-name">Device Name</label>
                    <input type="text" class="form-input focusable" id="device-name" value="ESP32-Robot" aria-label="Device Name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="refresh-rate">Refresh Rate: <span id="refresh-rate-value">100</span>ms</label>
                    <input type="range" class="slider focusable" min="50" max="500" value="100" step="10" 
                           oninput="updateRefreshRate(this.value)" id="refresh-rate" aria-label="Refresh Rate">
                </div>
                <div class="switch-group">
                    <div class="switch-info">
                        <label class="form-label" for="auto-connect">Auto Connect</label>
                        <div class="switch-description">Automatically connect on startup</div>
                    </div>
                    <div class="switch active focusable" onclick="toggleSwitch(this)" id="auto-connect" tabindex="0" role="switch" aria-checked="true">
                        <div class="switch-thumb"></div>
                    </div>
                </div>
                <div class="switch-group">
                    <div class="switch-info">
                        <label class="form-label" for="power-saving">Power Saving</label>
                        <div class="switch-description">Reduce power consumption when idle</div>
                    </div>
                    <div class="switch focusable" onclick="toggleSwitch(this)" id="power-saving" tabindex="0" role="switch" aria-checked="false">
                        <div class="switch-thumb"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="firmware-version">Firmware Version</label>
                    <select class="select focusable" id="firmware-version" aria-label="Firmware Version">
                        <option value="v2.1">v2.1 (Latest)</option>
                        <option value="v2.0">v2.0</option>
                        <option value="v1.9">v1.9</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                    </svg>
                    Advanced Settings
                </div>
                <div class="switch-group">
                    <div class="switch-info">
                        <label class="form-label" for="debug-mode">Debug Mode</label>
                        <div class="switch-description">Enable detailed logging for troubleshooting</div>
                    </div>
                    <div class="switch focusable" onclick="toggleSwitch(this)" id="debug-mode" tabindex="0" role="switch" aria-checked="false">
                        <div class="switch-thumb"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="log-level">Log Level</label>
                    <select class="select focusable" id="log-level" aria-label="Log Level">
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-outline focusable" onclick="resetSettings()" aria-label="Reset Settings">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                        <path d="M3 3v5h5"></path>
                    </svg>
                    Reset
                </button>
                <button class="btn btn-secondary focusable" onclick="toggleSettings()" aria-label="Cancel">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Cancel
                </button>
                <button class="btn btn-primary focusable" onclick="saveSettings()" aria-label="Save Settings">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Save
                </button>
            </div>
        </div>
    </div>

    <script>
        // JavaScript untuk Settings Modal dan fungsi lainnya
        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                document.getElementById('wifi-ssid').focus();
                addLogEntry('Settings modal opened', 'info');
            } else {
                addLogEntry('Settings modal closed', 'info');
            }
        }

        function toggleSwitch(element) {
            element.classList.toggle('active');
            const isActive = element.classList.contains('active');
            element.setAttribute('aria-checked', isActive);
            addLogEntry(`${element.id} set to ${isActive ? 'ON' : 'OFF'}`, 'info');
            if ('vibrate' in navigator) {
                navigator.vibrate(50); // Haptic feedback
            }
        }

        function updateRefreshRate(value) {
            document.getElementById('refresh-rate-value').textContent = value;
            addLogEntry(`Refresh rate set to ${value}ms`, 'info');
        }

        function saveSettings() {
            const ssid = document.getElementById('wifi-ssid').value;
            const password = document.getElementById('wifi-password').value;
            const deviceName = document.getElementById('device-name').value;
            const refreshRate = document.getElementById('refresh-rate').value;
            const autoConnect = document.getElementById('auto-connect').classList.contains('active');
            const powerSaving = document.getElementById('power-saving').classList.contains('active');
            const debugMode = document.getElementById('debug-mode').classList.contains('active');
            const logLevel = document.getElementById('log-level').value;

            addLogEntry('Settings saved', 'success');
            toggleSettings();
        }

        function resetSettings() {
            document.getElementById('wifi-ssid').value = 'ESP32_Network';
            document.getElementById('wifi-password').value = '********';
            document.getElementById('device-name').value = 'ESP32-Robot';
            document.getElementById('refresh-rate').value = 100;
            document.getElementById('refresh-rate-value').textContent = '100';
            document.getElementById('auto-connect').classList.add('active');
            document.getElementById('auto-connect').setAttribute('aria-checked', 'true');
            document.getElementById('power-saving').classList.remove('active');
            document.getElementById('power-saving').setAttribute('aria-checked', 'false');
            document.getElementById('debug-mode').classList.remove('active');
            document.getElementById('debug-mode').setAttribute('aria-checked', 'false');
            document.getElementById('log-level').value = 'info';

            addLogEntry('Settings reset to default', 'warning');
        }

        // Fungsi untuk log (dari kode sebelumnya)
        function addLogEntry(message, type) {
            const logContent = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // Fungsi lainnya dari kode sebelumnya tetap sama
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            addLogEntry(`Switched to ${tab} tab`, 'info');
        }

        function startMovement(direction) {
            addLogEntry(`${direction} movement started`, 'info');
        }

        function stopMovement(direction) {
            addLogEntry(`${direction} movement stopped`, 'info');
        }

        function togglePump() {
            const pumpBtn = document.getElementById('pump-btn');
            pumpBtn.classList.toggle('active');
            addLogEntry(`Pump ${pumpBtn.classList.contains('active') ? 'ON' : 'OFF'}`, 'info');
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        function updateServo(value) {
            document.getElementById('servo-value').textContent = `${value}°`;
            addLogEntry(`Servo position set to ${value}°`, 'info');
        }

        // Joystick Logic
        let isDragging = false;
        const joystick = document.getElementById('joystick');
        const joystickKnob = document.getElementById('joystick-knob');
        const joystickX = document.getElementById('joystick-x');
        const joystickY = document.getElementById('joystick-y');
        const directionValue = document.getElementById('direction-value');

        function startJoystick(event) {
            isDragging = true;
            joystick.classList.add('active');
            moveJoystick(event);
            addLogEntry('Joystick interaction started', 'info');
        }

        function moveJoystick(event) {
            if (!isDragging) return;
            event.preventDefault();
            
            const rect = joystick.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const maxDistance = rect.width / 2 - joystickKnob.offsetWidth / 2;

            let clientX, clientY;
            if (event.type.includes('touch')) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }

            let x = clientX - rect.left - centerX;
            let y = clientY - rect.top - centerY;

            const distance = Math.sqrt(x * x + y * y);
            if (distance > maxDistance) {
                const angle = Math.atan2(y, x);
                x = Math.cos(angle) * maxDistance;
                y = Math.sin(angle) * maxDistance;
            }

            joystickKnob.style.transform = `translate(${x}px, ${y}px)`;
            const normalizedX = Math.round((x / maxDistance) * 100);
            const normalizedY = Math.round((y / maxDistance) * 100);

            joystickX.textContent = normalizedX;
            joystickY.textContent = normalizedY;

            const angleDeg = (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
            let direction = 'CENTER';
            if (distance > 20) {
                if (angleDeg >= 337.5 || angleDeg < 22.5) direction = 'RIGHT';
                else if (angleDeg >= 22.5 && angleDeg < 67.5) direction = 'UP-RIGHT';
                else if (angleDeg >= 67.5 && angleDeg < 112.5) direction = 'UP';
                else if (angleDeg >= 112.5 && angleDeg < 157.5) direction = 'UP-LEFT';
                else if (angleDeg >= 157.5 && angleDeg < 202.5) direction = 'LEFT';
                else if (angleDeg >= 202.5 && angleDeg < 247.5) direction = 'DOWN-LEFT';
                else if (angleDeg >= 247.5 && angleDeg < 292.5) direction = 'DOWN';
                else if (angleDeg >= 292.5 && angleDeg < 337.5) direction = 'DOWN-RIGHT';
            }
            directionValue.textContent = direction;
        }

        function stopJoystick() {
            if (!isDragging) return;
            isDragging = false;
            joystick.classList.remove('active');
            joystickKnob.style.transform = 'translate(-50%, -50%)';
            joystickX.textContent = '0';
            joystickY.textContent = '0';
            directionValue.textContent = 'CENTER';
            addLogEntry('Joystick interaction stopped', 'info');
        }

        joystick.addEventListener('mousemove', moveJoystick);
        joystick.addEventListener('touchmove', moveJoystick);
        document.addEventListener('mouseup', stopJoystick);
        document.addEventListener('touchend', stopJoystick);

        // Battery and Sensor Updates
        function updateBattery() {
            const batteryPercentage = document.getElementById('battery-percentage');
            const batteryBarFill = document.getElementById('battery-bar-fill');
            const batteryDisplay = document.getElementById('battery-display');
            const level = Math.floor(Math.random() * 100);
            batteryPercentage.textContent = `${level}%`;
            batteryBarFill.style.width = `${level}%`;
            batteryDisplay.className = 'battery-display';
            if (level > 60) {
                batteryDisplay.classList.add('battery-high');
            } else if (level > 30) {
                batteryDisplay.classList.add('battery-medium');
            } else {
                batteryDisplay.classList.add('battery-low');
            }
            if (level < 20) {
                addLogEntry('Low battery warning', 'warning');
            }
        }

        function updateSensors() {
            document.getElementById('temp-value').textContent = `${Math.floor(Math.random() * 10) + 20}°C`;
            document.getElementById('humidity-value').textContent = `${Math.floor(Math.random() * 40) + 30}%`;
            document.getElementById('pressure-value').textContent = `${Math.floor(Math.random() * 100) + 950}hPa`;
            document.getElementById('distance-value').textContent = `${Math.floor(Math.random() * 100) + 50}cm`;

            ['temp-chart', 'humidity-chart', 'pressure-chart', 'distance-chart'].forEach(chartId => {
                const chart = document.getElementById(chartId);
                chart.innerHTML = '';
                for (let i = 0; i < 10; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.height = `${Math.random() * 40 + 10}px`;
                    chart.appendChild(bar);
                }
            });
        }

        // Update Time
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString('en-US', { 
                hour: 'numeric', 
                minute: 'numeric', 
                second: 'numeric', 
                hour12: true 
            });
        }

        // Initialize
        setInterval(updateTime, 1000);
        setInterval(updateBattery, 5000);
        setInterval(updateSensors, 3000);
        updateTime();
        updateBattery();
        updateSensors();

        // Keyboard Shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                if (!document.getElementById('settings-modal').classList.contains('hidden')) {
                    toggleSettings();
                }
            }
            if (event.key === '1') switchTab('control');
            if (event.key === '2') switchTab('stats');
            if (event.key === 's') toggleSettings();
            if (event.key === 'p') togglePump();
            if (event.key === 'ArrowUp') startMovement('forward');
            if (event.key === 'ArrowDown') startMovement('backward');
        });

        document.addEventListener('keyup', (event) => {
            if (event.key === 'ArrowUp') stopMovement('forward');
            if (event.key === 'ArrowDown') stopMovement('backward');
        });

        // Performance Monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                const fps = frameCount / ((currentTime - lastTime) / 1000);
                if (fps < 30) {
                    addLogEntry(`Low performance: ${fps.toFixed(1)} FPS`, 'warning');
                }
                frameCount = 0;
                lastTime = currentTime;
            }
            requestAnimationFrame(monitorPerformance);
        }
        monitorPerformance();
    </script>
</body>
</html>
